/*
vim: syntax=groovy
-*- mode: groovy;-*-
 *  ----------------------------------------------------------------------------------
 *  Base configuration. Run the pipeline using minimal test data.
 *  Intended infrastucture: Test server, CI testing
 */

docker {
   enabled = true
 }

params {
  name = "testrun"
  busco_data = "busco_example"
}


process {
    executor = 'local'
    time = { check_max( 60.m * task.attempt, 'time') }
    cpus = { check_max( 24 * task.attempt, 'cpus') }
    memory = { check_max( 60.GB * task.attempt, 'memory') }
    errorStrategy = { task.exitStatus == 143 ? 'retry' : 'finish' }
    maxRetries = 0
    maxErrors = '-1'
    validExitStatus = [0,127]
    withName: busco {
        beforeScript = "cd $baseDir/data; python busco_data.py download test; cd -"
    }

}
